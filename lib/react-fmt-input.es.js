import{jsx as e,jsxs as t}from"react/jsx-runtime";import{useRef as n,useState as r,useCallback as s,useEffect as o}from"react";const a=["^","_","#",undefined];const l=e=>{if(e===null||e===undefined)return"";return e.replace(/[^A-ZА-Я0-9]/gi,"")};const c=(e,t)=>{let n=[];for(let r=0,s=0;s<t.length;++s)if(a.includes(t[s])){if(r>=e.length)break;n.push(e[r++])}else n.push(t[s]);return n.join("")};const i=e=>{let t=0;while(!a.includes(e[t])&&t<e.length)t++;return t};const u=(e,t,n)=>{let r=0;for(let e=0;e<n;++e)if(a.includes(t[e]))r++;return r};const p=(e,t,n)=>{requestAnimationFrame((()=>{if(n)t=n();e.setSelectionRange(t,t)}))};const f=(e,t,n)=>{let r=0;for(let e=0;r<t.length&&e<n;++r)if(a.includes(t[r]))e++;return r};const d=({label:a,value:d,parser:g,mask:h,placeholder:b,errorMessage:m,formatter:v,onChange:y})=>{g=g||l;v=v||c;const k=n(null);const x=v(d,h);const S=n(Math.random().toString(36));const[w,D]=r(false);const $=w?{border:"2px solid red"}:{};const j=s((e=>{if(e.length===0)return"";const t=h.split("").slice(0,e.length);t.unshift("");const n=t.join("\\").replace(/\\#/g,"\\d").replace(/\\\^/g,"[A-ZА-Я]").replace(/\\_/g,"[a-zа-я]");return`^${n}$`}),[h]);const E=s(((e,t)=>{if(e.length===0){t&&D(false);return true}const n=new RegExp(j(e));if(n.test(e)){t&&D(false);return true}else{t&&D(true);return false}}),[h]);const A=s((e=>{const t=e.target;const n=t.value.substr(0,h.length);let r=t.selectionStart||i(h);const s=g?g(n):n;y(s);if(r<n.length)p(t,r)}),[g,y,h]);const C=s((e=>{var t;let n=((t=k.current)===null||t===void 0?void 0:t.selectionStart)||i(h);const r=e.target;switch(e.key){case"ArrowUp":case"Home":case"Escape":if(e.key==="Escape")y("");const t=i(h);p(r,t);e.preventDefault();e.stopPropagation();break;case"Backspace":{const t=u(d,h,n);const s=`${d.substring(0,t-1)}${d.substring(t,d.length)}`;let o=f(s,h,t);o=Math.max(o-1,i(h));y(s);p(r,o);e.preventDefault();e.stopPropagation();break}case"Delete":{const t=u(d,h,n);const s=`${d.substring(0,t)}${d.substring(t+1,d.length)}`;y(s);p(r,n);e.preventDefault();e.stopPropagation();break}}}),[h,d,y]);const F=s((e=>{const t=e.target;p(t,0,(()=>{const e=i(h);if((t.selectionStart||0)<e)return e;return t.selectionStart||0}))}),[h]);o((()=>{E(x,true)}),[x,E]);return e("div",{style:{height:"2.5rem"},children:t("label",{htmlFor:S.current,style:{display:"flex"},children:[t("span",{style:{margin:"5px"},children:[a," "]}),t("div",{style:{display:"relative"},children:[e("input",{style:{position:"absolute",color:"#a9a9a9",pointerEvents:"none",border:"2px solid transparent",outline:"none"},tabIndex:-1,value:x.concat(b.slice(x.length)),onChange:()=>{}}),e("input",{id:S.current,style:{position:"absolute",caretColor:"black",background:"transparent",...$},ref:k,value:x,onInput:A,onKeyDown:C,onMouseDown:F}),e("div",{style:{color:"red",position:"relative",top:"1.4rem",fontSize:12},children:w&&m})]})]})})};export{l as defaultParser,c as defaultFormatter,d as FormattedInput};
//# sourceMappingURL=react-fmt-input.es.js.map