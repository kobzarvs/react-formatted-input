{"mappings":"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","sources":["src/index.tsx"],"sourcesContent":["import React, {\n  FormEvent,\n  useState,\n  KeyboardEvent,\n  useRef,\n  MouseEvent,\n  useCallback,\n  useEffect,\n} from 'react';\n\n\nexport interface FormattedInputProps {\n  label: string;\n  value: string;\n  mask: string;\n  placeholder: string;\n  errorMessage: string;\n  parser?: (str: string | null | undefined) => string;\n  formatter?: (str: string, mask: string) => string;\n  onChange: (str: string) => void;\n}\n\n\nconst MASK_CHARS = ['^', '_', '#', undefined];\n\nexport const defaultParser = (value: string | null | undefined): string => {\n  if (value === null || value === undefined) {\n    return '';\n  }\n  return value.replace(/[^A-ZА-Я0-9]/gi, '');\n};\n\nexport const defaultFormatter = (value: string, mask: string): string => {\n  let result = [];\n  for (let i = 0, m = 0; m < mask.length; ++m) {\n    if (MASK_CHARS.includes(mask[m])) {\n      if (i >= value.length) break;\n      result.push(value[i++]);\n    } else {\n      result.push(mask[m]);\n    }\n  }\n  return result.join('');\n};\n\nconst getStartPosition = (mask: string): number => {\n  let startPos = 0;\n  while (!MASK_CHARS.includes(mask[startPos]) && startPos < mask.length) {\n    startPos++;\n  }\n  return startPos;\n};\n\nconst getValuePosition = (\n  value: string,\n  mask: string,\n  maskPos: number,\n): number => {\n  let pos = 0;\n  for (let i = 0; i < maskPos; ++i) {\n    if (MASK_CHARS.includes(mask[i])) {\n      pos++;\n    }\n  }\n  return pos;\n};\n\nconst setCaret = (\n  target: HTMLInputElement,\n  pos: number,\n  callback?: () => number,\n) => {\n  requestAnimationFrame(() => {\n    if (callback) {\n      pos = callback();\n    }\n    target.setSelectionRange(pos, pos);\n  });\n};\n\nconst getMaskPosition = (\n  value: string,\n  mask: string,\n  valuePos: number,\n): number => {\n  let pos = 0;\n  for (let i = 0; pos < mask.length && i < valuePos; ++pos) {\n    if (MASK_CHARS.includes(mask[pos])) {\n      i++;\n    }\n    console.log(i, valuePos, pos, MASK_CHARS.includes(mask[pos]), value[i]);\n  }\n  return pos;\n};\n\nexport const FormattedInput = ({\n  label,\n  value,\n  parser,\n  mask,\n  placeholder,\n  errorMessage,\n  formatter,\n  onChange,\n}: FormattedInputProps) => {\n  parser = parser || defaultParser;\n  formatter = formatter || defaultFormatter;\n\n  const ref = useRef<HTMLInputElement | null>(null);\n  const formattedValue = formatter(value, mask);\n  const id = useRef(Math.random().toString(36));\n  const [error, setError] = useState(false);\n  const errorBorder = error ? {border: '2px solid red'} : {};\n\n  const getPattern = useCallback(\n    (value: string): string => {\n      if (value.length === 0) {\n        return '';\n      }\n\n      const maskChars = mask.split('').slice(0, value.length);\n      maskChars.unshift('');\n      const reStr = maskChars\n        .join('\\\\')\n        .replace(/\\\\#/g, '\\\\d')\n        .replace(/\\\\\\^/g, '[A-ZА-Я]')\n        .replace(/\\\\_/g, '[a-zа-я]');\n\n      return `^${reStr}$`;\n    },\n    [mask],\n  );\n\n  const validate = useCallback(\n    (value: string, showError: boolean): boolean => {\n      if (value.length === 0) {\n        showError && setError(false);\n        return true;\n      }\n\n      const re = new RegExp(getPattern(value));\n\n      if (re.test(value)) {\n        showError && setError(false);\n        console.log(value, true);\n        return true;\n      } else {\n        showError && setError(true);\n        console.log(value, false);\n        return false;\n      }\n    },\n    [mask],\n  );\n\n  const handleInput = useCallback(\n    (e: FormEvent<HTMLInputElement>) => {\n      // @ts-ignore\n      const target = e.target as HTMLInputElement;\n      const value = target.value.substr(0, mask.length);\n      let savePos = target.selectionStart || getStartPosition(mask);\n      const parsedValue = parser ? parser(value) : value;\n\n      onChange(parsedValue);\n      if (savePos < value.length) {\n        setCaret(target, savePos);\n      }\n    },\n    [parser, onChange, mask],\n  );\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent) => {\n      let caret = ref.current?.selectionStart || getStartPosition(mask);\n      const target = e.target as HTMLInputElement;\n\n      switch (e.key) {\n        case 'ArrowUp':\n        case 'Home':\n        case 'Escape':\n          if (e.key === 'Escape') {\n            onChange('');\n          }\n          const pos = getStartPosition(mask);\n\n          setCaret(target, pos);\n          e.preventDefault();\n          e.stopPropagation();\n          break;\n\n        case 'Backspace': {\n          const valuePos = getValuePosition(value, mask, caret);\n          const newValue = `${value.substring(0, valuePos - 1)}${value.substring(valuePos, value.length)}`;\n          let maskPos = getMaskPosition(newValue, mask, valuePos);\n\n          maskPos = Math.max(maskPos - 1, getStartPosition(mask));\n          onChange(newValue);\n          setCaret(target, maskPos);\n          e.preventDefault();\n          e.stopPropagation();\n          break;\n        }\n\n        case 'Delete': {\n          const valuePos = getValuePosition(value, mask, caret);\n          const newValue = `${value.substring(0, valuePos)}${value.substring(\n            valuePos + 1,\n            value.length,\n          )}`;\n\n          onChange(newValue);\n          setCaret(target, caret);\n          e.preventDefault();\n          e.stopPropagation();\n          break;\n        }\n      }\n    },\n    [mask, value, onChange],\n  );\n\n  const handleMouseDown = useCallback(\n    (e: MouseEvent) => {\n      // @ts-ignore\n      const target = e.target as HTMLInputElement;\n      setCaret(target, 0, () => {\n        const start = getStartPosition(mask);\n        if ((target.selectionStart || 0) < start) {\n          return start;\n        }\n        return target.selectionStart || 0;\n      });\n    },\n    [mask],\n  );\n\n  useEffect(() => {\n    validate(formattedValue, true);\n  }, [formattedValue, validate]);\n\n  return (\n    <div style={{height: '2.5rem'}}>\n      <label htmlFor={id.current} style={{display: 'flex'}}>\n        <span style={{margin: '5px'}}>{label} </span>\n        <div style={{display: 'relative'}}>\n          <input\n            style={{\n              position: 'absolute',\n              color: '#a9a9a9',\n              pointerEvents: 'none',\n              border: '2px solid transparent',\n              outline: 'none',\n            }}\n            tabIndex={-1}\n            value={formattedValue.concat(\n              placeholder.slice(formattedValue.length),\n            )}\n            onChange={() => {\n            }}\n          />\n          <input\n            id={id.current}\n            style={{\n              position: 'absolute',\n              caretColor: 'black',\n              background: 'transparent',\n              ...errorBorder,\n            }}\n            ref={ref}\n            value={formattedValue}\n            onInput={handleInput}\n            onKeyDown={handleKeyDown}\n            onMouseDown={handleMouseDown}\n          />\n          <div\n            style={{\n              color: 'red',\n              position: 'relative',\n              top: '1.4rem',\n              fontSize: 12,\n            }}\n          >\n            {error && errorMessage}\n          </div>\n        </div>\n      </label>\n    </div>\n  );\n};\n"],"names":[],"version":3,"file":"index.es.js.map"}